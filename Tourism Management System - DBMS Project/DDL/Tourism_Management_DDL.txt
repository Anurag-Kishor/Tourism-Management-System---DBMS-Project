-- SCHEMA: Tourism_Management_System

-- DROP SCHEMA "Tourism_Management_System" ;
-- DROP SCHEMA Tourism_Management_System CASCADE;

CREATE SCHEMA Tourism_Management_System;
SET search_path TO Tourism_Management_System;

CREATE TABLE "User"(
	UserID int PRIMARY KEY,
	Fname VARCHAR(10),
	Lname VARCHAR(10),
	Email VARCHAR(20),
	Phone Numeric(10),
	IsActive BOOLEAN DEFAULT TRUE,
	Gender CHAR(1) CHECK (GENDER IN('M','F','O')),
	AGE int
);
CREATE TABLE COPASSENGER(
	UID int NOT NULL REFERENCES  "User"(UserID),
	Fname VARCHAR(10),
	Lname VARCHAR(10),
	Email VARCHAR(20),
	Phone DECIMAL(12,0),
	Gender VARCHAR(6),
	AGE DECIMAL(2,0),
	PRIMARY KEY(UID,FNAME,LNAME)
);

CREATE TABLE BOOKING(
	BID int PRIMARY KEY,
	UserID int REFERENCES "User"(UserID) NOT NULL,
	Booking_Date Date,
	TripStart_Date Date,
	TripEnd_Date Date,
	Amount float
);

CREATE TABLE BOOKING_COPASSENGER(
	BID int NOT NULL REFERENCES BOOKING(BID),
	UserID int, 
	Fname VARCHAR(10) ,
	Lname VARCHAR(10) ,
	FOREIGN KEY(UserID,Fname,Lname) REFERENCES COPASSENGER(UID,FNAME,LNAME) ,
	PRIMARY KEY(UserID,Fname,Lname)
);

CREATE TABLE PACKAGE(
	PACKAGEID int PRIMARY KEY,
	TITLE  VARCHAR(15),
	DURATION int,
	NO_OF_PEOPLE int,
	IsActive BOOLEAN DEFAULT TRUE,
	AMOUNT float
);

CREATE TABLE BOOKING_FOR_PACKAGE(
	BID int REFERENCES BOOKING(BID) NOT NULL,
	PACKAGEID int REFERENCES PACKAGE(PACKAGEID) NOT NULL,
	PRIMARY KEY(BID,PACKAGEID)
);

CREATE TABLE LOCATION(
	PINCODE  Numeric(6) PRIMARY KEY,
	CITY VARCHAR(10),
	"state" VARCHAR(10)
);
CREATE TABLE TOURIST_SPOTS(
	SPOTID int PRIMARY KEY,
	"Name" VARCHAR(20),
	SEASON VARCHAR(10),
	RATINGS DECIMAL(1,0),
	ADDRESS VARCHAR(50),
	PINCODE Numeric(6) REFERENCES LOCATION(PINCODE) 
);
CREATE TABLE Package_Includes_Spots(
	PACKAGEID int  NOT NULL REFERENCES PACKAGE(PACKAGEID),
	SPOTID int NOT NULL REFERENCES TOURIST_SPOTS(SPOTID)  ON UPDATE CASCADE ON DELETE CASCADE,
	PRIMARY KEY(PACKAGEID,SPOTID)
);

CREATE TABLE GUIDE(
	GUIDEID int PRIMARY KEY,
	Fname VARCHAR(10),
	Lname VARCHAR(10),
	Email VARCHAR(20),
	Phone Numeric(10),
	Gender VARCHAR(6),
	AGE DECIMAL(2,0),
	ADDRESS VARCHAR(50),
	PINCODE Numeric(6) REFERENCES LOCATION(PINCODE)
);

CREATE TABLE Package_Includes_Guides(
	PACKAGEID int NOT NULL REFERENCES PACKAGE(PACKAGEID),
	GUIDEID int NOT NULL REFERENCES GUIDE(GUIDEID) ON DELETE CASCADE,
	PRIMARY KEY(PACKAGEID,GUIDEID)
);
CREATE TABLE RESTAURANT(
	RID int PRIMARY KEY,
	"Name" VARCHAR(20),
	PHONE Numeric(10),
	FOODTYPE VARCHAR(7),
	RATINGS float,
	ADDRESS VARCHAR(50),
	PINCODE Numeric(6) REFERENCES LOCATION(PINCODE)
);
CREATE TABLE RESTAURANT_CUISINES(
	RID int REFERENCES RESTAURANT(RID) ON DELETE CASCADE,
	CUISINES VARCHAR(20) NOT NULL,
	PRIMARY KEY(RID,CUISINES)
);
CREATE TABLE HOTEL(
	HOTELID int PRIMARY KEY,
	NAME_ VARCHAR(20),
	PHONE Numeric(10),
	FOODTYPE VARCHAR(7),
	RATINGS float,
	ADDRESS VARCHAR(50),
	PINCODE Numeric(6) REFERENCES LOCATION(PINCODE)
);
CREATE TABLE HOTEL_SERVICES(
	HOTELID int REFERENCES HOTEL(HOTELID) ON DELETE CASCADE,
	SERVICES VARCHAR(20) NOT NULL,
	PRIMARY KEY(HOTELID,SERVICES)
);

CREATE TABLE ROOM(
	HOTELID int REFERENCES HOTEL(HOTELID) ON DELETE CASCADE ,
	ROOM_NO DECIMAL(3,0)  NOT NULL,
	PRIMARY KEY(HOTELID,ROOM_NO),
	"Type" VARCHAR(6) CHECK( "Type" IN('AC','NON-AC')),
	BEDS int CHECK(BEDS>0),
	CAPACITY int CHECK(CAPACITY>0),
	RATE REAL,
	STATUS VARCHAR(10)
);

CREATE TABLE ROOM_FACILITIES(
	HOTELID int,
	ROOMNO int,
	FACILITY VARCHAR(20) NOT NULL,
	FOREIGN KEY (HOTELID,ROOMNO) REFERENCES ROOM(HOTELID,ROOM_NO) ON DELETE CASCADE,
	PRIMARY KEY(HOTELID,ROOMNO,FACILITY)
);

CREATE TABLE Package_Includes_Hotels(
	PACKAGEID int NOT NULL REFERENCES PACKAGE(PACKAGEID) ,
	HOTELID int,
	ROOMNO int,
	FOREIGN KEY (HOTELID,ROOMNO) REFERENCES ROOM(HOTELID,ROOM_NO) ON DELETE CASCADE,
	PRIMARY KEY(PACKAGEID,HOTELID,ROOMNO)
);

CREATE TABLE Booking_For_Hotel(
	BID int REFERENCES BOOKING(BID) NOT NULL,
	HOTELID int,
	ROOMNO int,
	FOREIGN KEY (HOTELID,ROOMNO) REFERENCES ROOM(HOTELID,ROOM_NO) ON DELETE CASCADE,
	PRIMARY KEY(BID,HOTELID,ROOMNO)
);